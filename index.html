<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BOLACHA MAKER - FIX</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --cyan: #00f2ff; --red: #ff4444; --bg: #050510; }
        body { margin: 0; background: var(--bg); color: white; font-family: sans-serif; overflow: hidden; }
        #game-container { position: relative; width: 100vw; height: 70vh; background: #000; border-bottom: 2px solid var(--cyan); }
        #player { position: absolute; width: 20px; height: 20px; background: var(--cyan); border-radius: 4px; z-index: 100; }
        .block-obj { position: absolute; width: 35px; height: 35px; border: 0.1px solid rgba(255,255,255,0.1); }
        .b-pedra { background: #555; }
        .b-lava { background: var(--red); box-shadow: 0 0 10px var(--red); }
        .b-bomba { background: #333; border-radius: 50%; border: 2px solid #000; }
        .b-bomba::after { content: 'üí£'; font-size: 12px; display: flex; justify-content: center; }
        #controls { height: 30vh; display: flex; justify-content: space-around; align-items: center; background: #0a0a20; }
        .btn { width: 80px; height: 60px; background: #1a1a3a; border: 2px solid var(--cyan); color: white; border-radius: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="player"></div>
        <div id="map-render"></div>
    </div>

    <div id="controls">
        <button class="btn" onmousedown="velX=-6" onmouseup="velX=0">ESQUERDA</button>
        <button class="btn" onclick="jump()">PULAR</button>
        <button class="btn" onmousedown="velX=6" onmouseup="velX=0">DIREITA</button>
        <button class="btn" style="border-color: #bc13fe;" onclick="interagir()">PEGAR (E)</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCBSYgExCqXc8dmkB2yyBuznofShzE-h7o",
            authDomain: "bolachamakergame.firebaseapp.com",
            databaseURL: "https://bolachamakergame-default-rtdb.firebaseio.com",
            projectId: "bolachamakergame",
            appId: "1:207720367456:web:1a58957162be2b080f4a05"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let posX = 50, posY = 50, velY = 0, velX = 0, isJumping = false;
        let blocos = [];
        let temBomba = false;

        function carregar() {
            db.ref('mapas').limitToLast(1).once('value', snap => {
                const render = document.getElementById('map-render');
                render.innerHTML = '';
                blocos = [];

                if (!snap.exists()) {
                    // SE N√ÉO TIVER MAPA, CRIA UM CH√ÉO PARA N√ÉO FICAR PRETO
                    for(let i=0; i<10; i++) { criarBloco(i*35, 300, 'cell b-pedra', i); }
                    return;
                }

                snap.forEach(m => {
                    m.val().dados.forEach(d => {
                        let x = (d.id % 20) * 35;
                        let y = Math.floor(d.id / 20) * 35;
                        criarBloco(x, y, d.cl, d.id);
                        if(d.cl.includes('spawn')) { posX = x; posY = y; }
                    });
                });
            });
        }

        function criarBloco(x, y, cl, id) {
            const b = document.createElement('div');
            b.className = 'block-obj ' + cl.replace('cell ', 'b-');
            b.style.left = x + 'px';
            b.style.top = y + 'px';
            document.getElementById('map-render').appendChild(b);
            blocos.push({x, y, type: cl, el: b});
        }

        function loop() {
            velY += 0.8; // Gravidade
            posY += velY;
            posX += velX;

            blocos.forEach(b => {
                if (posX < b.x + 30 && posX + 20 > b.x && posY < b.y + 30 && posY + 20 > b.y) {
                    if (b.type.includes('pedra')) {
                        if(velY > 0) { posY = b.y - 20; velY = 0; isJumping = false; }
                    }
                    if (b.type.includes('lava')) { location.reload(); }
                }
            });

            if(posY > 1000) { posX=50; posY=50; velY=0; } // Reset se cair
            
            document.getElementById('player').style.left = posX + 'px';
            document.getElementById('player').style.top = posY + 'px';
            requestAnimationFrame(loop);
        }

        function jump() { if(!isJumping) { velY = -12; isJumping = true; } }
        
        function interagir() {
            // L√≥gica simplificada da bomba para teste
            if(!temBomba) {
                alert("Procure uma bomba no mapa!");
            }
        }

        carregar();
        loop();
    </script>
</body>
</html>
